<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex,nofollow" />
    <meta property="fb:admins" content="712852254" />
    <title>Open Diary - March 2013</title>
    <link rev="made" href="mailto:kengoichiki@yahoo.com" />
    <link rel="stylesheet" type="text/css" href="diary.css" />
    <link rel="icon" href="images/favicon-16.png" />
    <script type="text/javascript" src="LaTeXMathML.js"></script>
  </head>

<body>

<table class="header"
 width="100%" border="0" cellspacing="0" cellpadding="0"
 summary="header">
 <tr>
  <td align="left">

<h1><a id="top"></a> <img src="images/NIKKI.png"
width="166" height="57"
alt="日記 -" /> 2013年3月</h1>
  </td>
  <td align="right">
<p>
[<a href="index.html">日記一覧</a>]
[<a href="../index-j.html">トップ</a>]
</p>
  </td>
 </tr>
</table>

<div class="body">

<hr />

<h2><a id="d3"></a>3/3 (Sun)</h2>
<ul>
 <li><a id="d3-waon"></a>[WaoN][github] WaoN の Win32 バイナリをリリース。
 <ul>
  <li><a href="#d2-waon">昨日</a>のつづき。</li>
  <li>gwaon で、 wav ファイルを開くと落ちる問題(<a href="diary2011_02.html#d27-gwaon">2/27/2011</a>)が解決。
  <ul>
   <li>詳しく調べていったら（と言っても、結果的には
    <a href="http://www.xiph.org/ao/">libao</a> の
    <a href="http://www.xiph.org/ao/doc/ao_example.c">サンプルコード</a>
    と、一つずつ確認していったら、ってことだけど）
    間違いを見つけた、という顛末だったんだけど…。</li>
   <li>ao_device の初期化部分で、
   <pre>
/* -- Initialize -- */
ao_initialize();

/* -- Setup for default driver -- */
int default_driver = ao_default_driver_id();

ao_sample_format format;
<font color="red">memset(&format, 0, sizeof(format));</font>
format.bits = 16;
format.channels = 2;
format.rate = 44100;
format.byte_format = AO_FMT_LITTLE;

/* -- Open driver -- */
ao_device *device = ao_open_live(default_driver, &format, NULL /* no options */);
   </pre>
    上の memset() の１行が、ぼくのコードには入ってなかった…。</li>
   <li>分かってみれば「なるほど、それで挙動不審だったのか」と納得するが
    （多分、初期化されてない部分が問題を起こす時があったのだろう）、
    この１行は、最近になって必要になったのだろうか？
    だって、絶対にオレ、サンプルコードを丸写ししたはずなので、
    ここだけ抜かすなんて器用な事、しないと思う…。</li>
   <li>commit: <a href="https://github.com/kichiki/WaoN/commit/c6f69f7b1d17cce2eed0f0152624bd3ad10487de">c6f69f7b1d17cce2eed0f0152624bd3ad10487de</a>
   <pre>
bug fixed on ao_device initialization.
   </pre>
   </li>
  </ul>
  </li>
  <li>と、スッキリしたところで、 Windows のバイナリをまとめる。</li>
  <li>実は、メールのアーカイブを調べてみたら、2010年4月21日に
   David Millis さんという方から、当時の WaoN (バージョン 0.9) を
   MinGW でビルドした、とメールを頂いていた。
  <ul>
   <li>彼は、 CUI な <a href="http://kichiki.github.com/waon/index.html">waon</a> のみビルドしてて、
    「curses を使った <a href="http://kichiki.github.com/waon/pv.html">pv</a> と GTK+ を使った <a href="http://kichiki.github.com/waon/gwaon.html">gwaon</a> は難しそう」
    とのことだった。</li>
   <li>親切にも、パッチだけでなくバイナリ（必要な dll 込み）も
    送ってもらってたが、
    多分バタバタしてたんだろう、結局、見えるところに置く事もしてなかった。</li>
   <li>ということで、まずは、頂いたパッチを適用しておく。</li>
   <li>commit: <a href="https://github.com/kichiki/WaoN/commit/be49359ed053a9c3ff304b5f95747141ea83d863">be49359ed053a9c3ff304b5f95747141ea83d863</a>
   <pre>
import MinGW patch provided by David Millis.
   </pre>
   </li>
   <li>見れば、先週ぼくが自分でやってた porting は、
    かなり適当だったことが分かる。
    （というのは、 stdout の file descriptor を取得する部分のこと。）</li>
  </ul>
  </li>
  <li>この上に、ぼくのやった他の porting を乗せることにする。
  <ul>
   <li><a href="http://kichiki.github.com/waon/pv.html">pv</a> は、（後でメールを確認したときに気づいた事だが、
    David が件のメールの中で suggest してくれてた）
    public domain な実装 <a href="http://pdcurses.sourceforge.net/">pdcurses</a>
    を使ったら、コードは何も変更なく、リンクすればそれだけでうまくいった。</li>
   <li><a href="http://kichiki.github.com/waon/gwaon.html">gwaon</a> に関しては、ここしばらく仕事で GTK+ なコードを Windows で
    動かすことに挑戦してて、「<a href="http://kevinboone.net/gtkwindows.html">Building native graphical applications in C for MS Windows, using GTK+ and open-source tools</a>」(Kevin Boone)に従ったら簡単に動いたので、
    そのまま <a href="http://kichiki.github.com/waon/gwaon.html">gwaon</a> もビルドしたら動いた。
    （でも、アイコンをまだ作ってない。
    誰か、かっこいいやつ、描いてくれないかなぁ〜）</li>
   <li>commit: <a href="https://github.com/kichiki/WaoN/commit/a3e23de7b96bab16ca8be8c27c9996eacb89944c">a3e23de7b96bab16ca8be8c27c9996eacb89944c</a>
   <pre>
MinGW port: add Makefiles for win32 builds.
   </pre>
    見てとのおり、David Millis 氏のパッチのおかげで、ソースは修正なし。</li>
  </ul>
  </li>
  <li><a href="http://kichiki.github.com/waon/index.html">web page</a> の方も改訂しておく。
  <ul>
   <li><a href="http://kichiki.github.com/waon/dist/index.html">ダウンロード・セクション</a>を作った。</li>
   <li>commit: <a href="https://github.com/kichiki/kichiki.github.com/commit/5d8fccdd5e4cdc10d45701b8ea4043117e0609e6">5d8fccdd5e4cdc10d45701b8ea4043117e0609e6</a>
   <pre>
update WaoN project page.

adding Download page waon/dist/index.html.
also add tar.gz files for each release and win32 binaries.
   </pre>
   </li>
  </ul>
  </li>
  <li>ってことなので、これまで WaoN に興味あったけど、
   Windows マシンしかなくてビルドできない！と悔しい思いをしていた皆さん、
   まだ確認作業などほとんどしてない状態ですが、ダウンロード
   (<a href="http://kichiki.github.com/waon/dist/waon-0.11-mingw.zip">waon-0.11-mingw.zip</a>)して、
   どんどん遊んでみてください。</li>
 </ul>
 </li>
</ul>

<h2><a id="d2"></a>3/2 (Sat)</h2>
<ul>
 <li><a id="d2-waon"></a>[WaoN][github] WaoN も github にお引越。
 <ul>
  <li><a href="diary2013_02.html#d24-github">2/24/2013</a>のつづき。</li>
  <li>前回の RYUON の時に手順ははっきりしたので、そのまま。
  <pre>
# prepare a working directory
% mkdir somewhere
% cd somewhere

# download CVS repository from SF
% rsync -av rsync://waon.cvs.sourceforge.net/cvsroot/waon/ waon

# convert CVS to GIT
# prepare authors.txt if you want
% mkdir repo
% cd repo
% git cvsimport -v -A ../authors.txt -d ../waon -C waon waon

# create a repository on GitHub (as WaoN.git)

# push to GitHub
# in repo directory
% git remote add origin https://github.com/kichiki/WaoN.git
% git push -u origin master
  </pre>
  </li>
  <li>できたレポジトリ (<a href="https://github.com/kichiki/WaoN">https://github.com/kichiki/WaoN</a>) の「Settings」タブから「GitHub Pages」セクションの「Automatic Page Generator」ボタンをクリックして、
   WaoN レポジトリのページを作る。
  <ul>
   <li>できた。 <a href="http://kichiki.github.com/WaoN">http://kichiki.github.com/WaoN</a></li>
   <li>レポジトリのページに戻って、一番上のサマリの左側にマウスを持ってって「Edit」をクリックして、このページを登録しておく。</li>
  </ul>
  </li>
  <li>前回、ユーザーページの方に持ってきておいた WaoN 関係のページへのリンクを追加しておく。
  <ul>
   <li><a href="http://kichiki.github.com/waon/index.html">WaoN</a></li>
   <li><a href="http://kichiki.github.com/waon/pv.html">pv</a></li>
   <li><a href="http://kichiki.github.com/waon/gwaon.html">gWaoN</a></li>
  </ul>
  </li>
  <li><a href="#d3-waon">3/3/2013</a>:
   Win32 バイナリ（waon, pv, gwaon）をプレリリース</li>
 </ul>
 </li>
</ul>

<hr />

</div><!-- end of body -->

<table class="footer"
 width="100%" border="0" cellspacing="0" cellpadding="0"
 summary="footer">
 <tr>
  <td align="left">
Copyright (C) 1997-2013, Kengo Ichiki
<br />
twitter: @<a href="http://twitter.com/ichiki_k">ichiki_k</a><br />
facebook: <a href="http://www.facebook.com/kengo.ichiki">Kengo Ichiki</a>
  </td>
  <td>

<!-- motigo webstats for Infoseek -->
<a id="mws1196334" href="http://webstats.motigo.com/">
<img width="18" height="18" border="0" alt="Free counter and web stats" src="http://m1.webstats.motigo.com/n.gif?id=ABJBLgPmCHIB5A59buMkc0vHZpwg" /></a>
<script src="http://m1.webstats.motigo.com/c.js?id=1196334" type="text/javascript"></script>
<!-- End Motigo Webstats counter code -->

<!--WEBBOT bot="HTMLMarkup" startspan ALT="Site Meter" -->
<a href="http://s10.sitemeter.com/stats.asp?site=s10kengoichiki">
<img src="http://s10.sitemeter.com/meter.asp?site=s10kengoichiki"
 width="38" height="15" alt="Site Meter" /></a>
<!--WEBBOT bot="HTMLMarkup" Endspan -->

  </td>
  <td align="right">
<p>
[<a href="index.html">日記一覧</a>]
[<a href="../index-j.html">トップ</a>]
</p>
  </td>
 </tr>
</table>

</body>
</html>
